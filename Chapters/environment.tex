
\chapter{Testing environment }

A simulation environment was developed with the purpose of testing the various filtering algorithms in this thesis. Specific effort was devoted in developing the codebase in a modular way, so that most of the software code can be reused in between different simulation setups. Implementing new methods should be a matter of designing a new class, which can be readily tested on the core simulator code. While software development in this thesis is focused mostly on providing a workable test environment, the author was looking into forward integration of the code in a broader software stack. In that sense specific effort had to be devoted into following good development practices, by documenting code where necessary, following naming conventions and maintaining a code quality that will assist in possible future integration of the code.


\section{Simulator characteristics}

An environment is defined by:
\begin{itemize}
	\item State space definition 
	\item Sample time $T_s$ that defines the state transition calculations.
	\item Simulated objects list
	\item Tracked targets list
	\item Sensor modules
	\item Environment visualization plots
	\item Tracking performance metrics
\end{itemize}


\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{information_pyramide.png}
	\caption{Data distillation process}.
	\label{fig:information_pyramide}
\end{figure}


\begin{description}
	\item[State-space] Defines the motion and observation models(see \Cref{sec:SS})
	\begin{itemize}
		\item Cartesian position and cartesian velocity, i.e. $ x=[x,y,\boatspeed_x, \boatspeed_y] $
		\item Cartesian position and polar velocity, i.e. $ x = [x,y,|\boatspeed|,\heading]$
	\end{itemize}
\end{description}

\begin{description}
	\item[Moving objects] A list of simulated point objects in the environment defined by:
	\begin{itemize}
		\item An objects initial state $x_0$
		\item Selected simulation motion model $f(\cdot)$
		\item Selected process noise intensities $ \procnoise $
	\end{itemize}
\end{description}

\begin{description}
	\item[Tracked targets] Maintain a list of tracked targets. Each target is created given:
	\begin{itemize}
		\item Initial estimated target state $\hat{x}_0$
		\item Initial tracked target state uncertainty $P(0)$
		\item A filter which can be based on
			\begin{description}
				\item[Continuous methods]:
					\begin{itemize}
						\item Kalman Filter
						\item Extended Kalman Filter
						\item Probabilistic Data Association Extended Kalman Filter
					\end{itemize}		
			\end{description}
			\begin{description}
				\item[Sampled methods]:
					\begin{itemize}
						\item Particle Filter
						\item Probabilistic Data Association Particle Filter
					\end{itemize}
			\end{description}			
	\end{itemize}
\end{description}


\begin{description}
	\item[Sensor modules] Each type of sensor defines a different class and each modeled sensor in the environment is defined by a different object. During the environment updates, the sensor modules are providing observations to the filtering module either as simulated sensors, or from real data logs.
	\begin{description}
		\item[Simulated sensors]
		\begin{itemize}
			\item[]
			\item Simulated measurements are being calculated for the simulated \emph{moving objects} based on a sensor's observation model $h(\cdot)$, at a defined simulated sensor update frequency.
			\item Variable observation noise intensities \measnoise
			\item Variable number of outliers
			\item Concerning the Data Association problem as described in \Cref{ch:Tracking}, when using simulated sensors, a measurement's origin is always available and knowledge of such can either be assumed known or unknown in the filtering algorithms.
		\end{itemize}
		\item[Real data]
				\begin{itemize}
					\item[]
					\item Data logs are being aggregated and sampled into an indexing data-structure based on their timestamps and the environment sample time $T_s$.
					\item Observations are being "fetched" by the sensor module whenever a new measurement is available based on the current steps.
				\end{itemize}
		
	\end{description}
\end{description}

	
	
\section{Differences between simulated and real targets}

The general environment structure allows for little to no changes in the test scripts when having to switch between simulating a target or using the actual recorded data. Most of the changes concern the lack of actual ground truth for the targets to compare against filtering performance, and re-tuning of filtering parameters.
\begin{itemize}
	\item  The origin of an observation is not associated with a tracked target, hence the data association problem arises.
	\item No ground truth is available for the real targets.
	\item Possible mismatch in the modeled motion noise 
	\item Possible mismatch in the modeled observation noise.
	\item Possible mismatch in the observation association process.
\end{itemize}

\section{3D visualization}

Usually a picture is worth a thousand words, with that in mind a visualization module based on MATLAB built-in functionalities was developed, trying to illustrate the different tracking scenarios and provide filtering performance graphs. 

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{simulator.png}
	\caption{3d Representation of a simulated tracked ship. Blue trajectory corresponds to the ground truth, where red trajectory corresponds to the estimated position. Red and green ellipses correspond to $3\sigma$ confidence intervals after the prediction and the measurement update step respectively. The point clouds above the ship illustrate the Particle Filter.}
	\label{fig:simulator1}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{good_one.png}
		\caption{Particle Filter focused representation. A ship's position estimates along with its estimation history, emphasis on visualizing the Particle Filter as  point-clouds}	\label{fig:simulator2}
\end{figure}


\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{3ple_cross.png}
	\caption{Triple ship tracking in crossing scenario, using probabilistic data association (PDA) to maintain multiple target tracks.	}\label{fig:simulator3}
\end{figure}


\section{Summary}

A simulation and verification environment is build based on the MATLAB framework, with emphasis on code re-usability, modularity in simulating different sensor and motion models, and rapid prototype testing of either continuous or sampled filtering algorithms. A visualization model provides feedback for the performance of the filter algorithms.



